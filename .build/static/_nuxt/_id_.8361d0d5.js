import{g as B,r as k,J as R,i as W,o as y,c as v,a as u,b as r,w as m,q as e,A as X,D as V,p as U,f as F,_ as E,v as Y,x as Z,l as ee,h as N,d as h,F as T,t as $,z as ae,C as te,E as L,B as ne,e as se,I as oe,n as le}from"./entry.9dbfbc2c.js";import{_ as re,a as ce}from"./InputField.54f2adc8.js";import{_ as J}from"./UserPlacesMap.7c6a0897.js";import{_ as ie}from"./UserPlacesSection.bf312de3.js";import{u as de}from"./usePlacesStore.5fcb8dfe.js";import{i as ue,w as x}from"./dataStore.d7792384.js";import{_ as _e}from"./Fab.8c80f483.js";import{u as pe}from"./useItinerariesStore.2d8857d2.js";import"./index.a5ba7d56.js";import"./vue-leaflet.es.86c67db3.js";import"./StarRating.c3e15fc6.js";import"./index.db22a8d1.js";const O=d=>(U("data-v-394c518c"),d=d(),F(),d),me=O(()=>u("p",null,"Select places to add...",-1)),fe=O(()=>u("span",{class:"fa fa-times"},null,-1)),ye={key:0},ve={key:1},ge={class:"places-map"},De=B({__name:"UserAddItineraryPlaceDialog",props:{open:{type:Boolean}},emits:["placeSelected","closed"],setup(d,{emit:b}){const n=d,c=de(),_=k(),p=a=>b("placeSelected",a);return R(()=>{var a,t;n.open?(a=_.value)==null||a.showModal():(t=_.value)==null||t.close()}),W(()=>ue(()=>c.places,c)),(a,t)=>{const i=V,o=ie,g=J;return a.open?(y(),v("dialog",{key:0,ref:D=>_.value=D,onClose:t[1]||(t[1]=D=>b("closed"))},[u("header",null,[me,r(i,{color:"danger",onClick:t[0]||(t[0]=D=>b("closed"))},{default:m(()=>[fe]),_:1})]),e(c).places?(y(),v("div",ve,[r(o,{places:e(c).places,onPlaceFocused:p},null,8,["places"]),u("section",ge,[r(g,{places:e(c).places,"focusable-places":!0,"show-places-names":!0,onPlaceFocused:p},null,8,["places"])])])):(y(),v("p",ye,"Loading..."))],544)):X("",!0)}}});const he=E(De,[["__scopeId","data-v-394c518c"]]),be=(d,b,n)=>{function c(a,t){const i={type:d,value:a};t.dataTransfer.setData("application/json",JSON.stringify(i)),t.dataTransfer.effectAllowed="move"}function _(a){if(!a.dataTransfer)return;const t=a.dataTransfer.types.find(i=>i==="application/json");a.dataTransfer.dropEffect=t?"move":"none",t&&a.preventDefault()}function p(a,t){var S;const i=(S=t.dataTransfer)==null?void 0:S.getData("application/json");if(!i){console.error("No dragdrop data");return}const o=JSON.parse(i);if(!o){console.error("Invalid dragdrop data: "+i);return}if((n==null?void 0:n.acceptedTypes)?!n.acceptedTypes.includes(o.type):o.type!==d){console.error("Invalid dragdrop data target: "+o.type+" [Accepts "+((n==null?void 0:n.acceptedTypes)??d)+"]");return}const D=o.value;if(!D){console.error("No drop source element");return}if(n!=null&&n.filterElement&&!n.filterElement(D,a,n.collectionId)){console.log("Element filtered.");return}t.preventDefault(),b(D,a,n==null?void 0:n.collectionId),t.dataTransfer.clearData()}return{onStartDragging:c,canDropOntoItem:_,onDropEvent:p}},C=d=>(U("data-v-18eb04be"),d=d(),F(),d),ke={key:0},we={key:1},xe=C(()=>u("span",{class:"fa fa-arrow-left"},null,-1)),Ie={key:0},Pe={key:1},Se={class:"itinerary-list"},Ae=["onDragstart","onDrop"],$e=C(()=>u("span",null,"=",-1)),Ce=C(()=>u("span",{class:"fa fa-trash"},null,-1)),Ne={class:"itinerary-map"},Te=B({__name:"[id]",setup(d){const b=Y(),n=Z(),c=pe(),_=k(b.params.id),p=ee(()=>{var l;return(l=c.itineraries)==null?void 0:l.find(s=>s._id===_.value)}),a=k(!1),t=k(!1),i=k(!1),o=k(!1),g=k(""),D=l=>x(o,c.addPlaceAsync(_.value,l),!1),S=l=>x(o,c.removePlaceAsync(_.value,l),!1),M=()=>x(o,c.deleteAsync(_.value).then(l=>{l&&ne("/itineraries")}),null),A=be("itineraryPlace",async(l,s)=>{var I;(I=p.value)!=null&&I.places&&await x(o,c.swapPlacesAsync(_.value,l._id,s._id),!1)});return N(n.userStore,l=>{l.userData&&x(o,c.fetchOneAsync(_.value),null)},{immediate:!0}),R(()=>{var l;return g.value=((l=p.value)==null?void 0:l.name)??""}),N(i,(l,s)=>{p.value&&s&&!l&&g.value!==p.value.name&&x(o,c.updateAsync({_id:_.value,name:g.value}),!1)}),(l,s)=>{const I=se,j=oe,z=ce,q=re,P=V,G=le,H=J,K=he,Q=_e;return y(),v("main",null,[e(n).userStore.userData?e(p)?(y(),v(T,{key:2},[u("header",null,[r(j,{to:"/itineraries",class:"hidden-on-mobile"},{"icon-left":m(()=>[xe]),default:m(()=>[h(" Back ")]),_:1}),e(i)?(y(),v("div",Pe,[r(z,{text:"New name",for:"newName"}),r(q,{class:"new-name-field",type:"text",modelValue:e(g),"onUpdate:modelValue":s[0]||(s[0]=f=>ae(g)?g.value=f:null),id:"newName",placeholder:"Input a name..."},null,8,["modelValue"])])):(y(),v("h2",Ie,$(e(g)),1)),r(P,{disabled:e(o),onClick:s[1]||(s[1]=f=>i.value=!e(i))},{default:m(()=>[h($(e(i)?"Confirm":"Rename"),1)]),_:1},8,["disabled"]),r(P,{disabled:e(o),color:"danger",onClick:M},{default:m(()=>[h(" Delete ")]),_:1},8,["disabled"])]),u("div",{class:L({"itinerary-container":!0,"itinerary-list-visible":e(a),"itinerary-map-visible":!e(a)})},[u("section",Se,[u("ol",null,[(y(!0),v(T,null,te(e(p).places,f=>(y(),v("li",{draggable:!0,onDragstart:w=>e(A).onStartDragging(f,w),onDragover:s[2]||(s[2]=w=>e(A).canDropOntoItem(w)),onDrop:w=>e(A).onDropEvent(f,w)},[r(G,{class:"itinerary-list-element"},{default:m(()=>[$e,u("p",null,$(f.name),1),r(P,{color:"danger",onClick:w=>S(f._id)},{default:m(()=>[Ce]),_:2},1032,["onClick"])]),_:2},1024)],40,Ae))),256))]),r(P,{"full-width":!0,disabled:e(o),color:"primary",onClick:s[3]||(s[3]=f=>t.value=!0)},{default:m(()=>[h(" + ")]),_:1},8,["disabled"])]),u("section",Ne,[r(H,{places:e(p).places,"focusable-places":!1,"show-places-names":!0},null,8,["places"])]),r(P,{"full-width":!0,color:e(a)?"grey":"primary",radius:"0",class:"toggle-list-button",onClick:s[4]||(s[4]=f=>a.value=!e(a))},{default:m(()=>[u("span",{class:L({fa:!0,"fa-list":!e(a),"fa-map":e(a)})},null,2)]),_:1},8,["color"])],2),r(K,{open:e(t),onClosed:s[5]||(s[5]=f=>t.value=!1),onPlaceSelected:D},null,8,["open"]),r(Q,{disabled:e(o),color:"primary",class:"hidden-on-mobile",onClick:s[6]||(s[6]=f=>t.value=!0)},{default:m(()=>[h(" + ")]),_:1},8,["disabled"])],64)):(y(),v("p",we,"Loading...")):(y(),v("p",ke,[r(I,{to:"/login"},{default:m(()=>[h("Log in")]),_:1}),h(" or "),r(I,{to:"/register"},{default:m(()=>[h("Sign up")]),_:1}),h(" to create itineraries! ")]))])}}});const Ge=E(Te,[["__scopeId","data-v-18eb04be"]]);export{Ge as default};
