import{g as B,r as w,J as R,i as W,o as y,c as v,a as u,b as r,w as f,q as e,A as X,D as V,p as U,f as F,_ as E,v as Y,x as Z,l as ee,h as N,d as h,F as T,t as $,z as ae,C as te,E as L,B as ne,e as se,I as oe,n as le}from"./entry.bb74548b.js";import{_ as re,a as ce}from"./InputField.5fb3cb1e.js";import{_ as J}from"./UserPlacesMap.0018731b.js";import{_ as de}from"./UserPlacesSection.4461930d.js";import{u as ie}from"./usePlacesStore.3ccf87c0.js";import{i as ue,w as I}from"./dataStore.d7792384.js";import{_ as _e}from"./Fab.eb68e09a.js";import{u as pe}from"./useItinerariesStore.7efcc161.js";import"./index.f4bf0056.js";import"./vue-leaflet.es.9a8bcf82.js";import"./StarRating.63be099d.js";import"./index.97fe0762.js";const O=i=>(U("data-v-ccd8f0cd"),i=i(),F(),i),fe=O(()=>u("p",null,"Select places to add...",-1)),me=O(()=>u("span",{class:"fa fa-times"},null,-1)),ye={key:0},ve={key:1},ge={class:"places-map"},De=B({__name:"UserAddItineraryPlaceDialog",props:{open:{type:Boolean}},emits:["placeSelected","closed"],setup(i,{emit:k}){const n=i,c=ie(),_=w(),p=a=>k("placeSelected",a);return R(()=>{var a,t;n.open?(a=_.value)==null||a.showModal():(t=_.value)==null||t.close()}),W(()=>ue(()=>c.places,c)),(a,t)=>{const d=V,o=de,g=J;return a.open?(y(),v("dialog",{key:0,ref:D=>_.value=D,onClose:t[2]||(t[2]=D=>k("closed"))},[u("header",null,[fe,r(d,{color:"danger",onClick:t[0]||(t[0]=D=>k("closed"))},{default:f(()=>[me]),_:1})]),e(c).places?(y(),v("div",ve,[r(o,{places:e(c).places,onPlaceFocused:p,onClick:t[1]||(t[1]=D=>k("closed"))},null,8,["places"]),u("section",ge,[r(g,{places:e(c).places,"focusable-places":!0,"show-places-names":!0,onPlaceFocused:p},null,8,["places"])])])):(y(),v("p",ye,"Loading..."))],544)):X("",!0)}}});const he=E(De,[["__scopeId","data-v-ccd8f0cd"]]),ke=(i,k,n)=>{function c(a,t){const d={type:i,value:a};t.dataTransfer.setData("application/json",JSON.stringify(d)),t.dataTransfer.effectAllowed="move"}function _(a){if(!a.dataTransfer)return;const t=a.dataTransfer.types.find(d=>d==="application/json");a.dataTransfer.dropEffect=t?"move":"none",t&&a.preventDefault()}function p(a,t){var b;const d=(b=t.dataTransfer)==null?void 0:b.getData("application/json");if(!d){console.error("No dragdrop data");return}const o=JSON.parse(d);if(!o){console.error("Invalid dragdrop data: "+d);return}if((n==null?void 0:n.acceptedTypes)?!n.acceptedTypes.includes(o.type):o.type!==i){console.error("Invalid dragdrop data target: "+o.type+" [Accepts "+((n==null?void 0:n.acceptedTypes)??i)+"]");return}const D=o.value;if(!D){console.error("No drop source element");return}if(n!=null&&n.filterElement&&!n.filterElement(D,a,n.collectionId)){console.log("Element filtered.");return}t.preventDefault(),k(D,a,n==null?void 0:n.collectionId),t.dataTransfer.clearData()}return{onStartDragging:c,canDropOntoItem:_,onDropEvent:p}},C=i=>(U("data-v-59949cd7"),i=i(),F(),i),we={key:0},xe={key:1},Ie=C(()=>u("span",{class:"fa fa-arrow-left"},null,-1)),Pe={key:0},Se={key:1},be={class:"itinerary-list"},Ae=["onDragstart","onDrop"],$e=C(()=>u("span",null,"=",-1)),Ce=C(()=>u("span",{class:"fa fa-trash"},null,-1)),Ne={class:"itinerary-map"},Te=B({__name:"[id]",setup(i){const k=Y(),n=Z(),c=pe(),_=w(k.params.id),p=ee(()=>{var l;return(l=c.itineraries)==null?void 0:l.find(s=>s._id===_.value)}),a=w(!1),t=w(!1),d=w(!1),o=w(!1),g=w(""),D=l=>I(o,c.addPlaceAsync(_.value,l),!1),b=l=>I(o,c.removePlaceAsync(_.value,l),!1),M=()=>I(o,c.deleteAsync(_.value).then(l=>{l&&ne("/itineraries")}),null),A=ke("itineraryPlace",async(l,s)=>{var P;(P=p.value)!=null&&P.places&&await I(o,c.swapPlacesAsync(_.value,l._id,s._id),!1)});return N(n.userStore,l=>{l.userData&&I(o,c.fetchOneAsync(_.value),null)},{immediate:!0}),R(()=>{var l;return g.value=((l=p.value)==null?void 0:l.name)??""}),N(d,(l,s)=>{p.value&&s&&!l&&g.value!==p.value.name&&I(o,c.updateAsync({_id:_.value,name:g.value}),!1)}),(l,s)=>{const P=se,j=oe,z=ce,q=re,S=V,G=le,H=J,K=he,Q=_e;return y(),v("main",null,[e(n).userStore.userData?e(p)?(y(),v(T,{key:2},[u("header",null,[r(j,{to:"/itineraries",class:"hidden-on-mobile"},{"icon-left":f(()=>[Ie]),default:f(()=>[h(" Back ")]),_:1}),e(d)?(y(),v("div",Se,[r(z,{text:"New name",for:"newName"}),r(q,{class:"new-name-field",type:"text",modelValue:e(g),"onUpdate:modelValue":s[0]||(s[0]=m=>ae(g)?g.value=m:null),id:"newName",placeholder:"Input a name..."},null,8,["modelValue"])])):(y(),v("h2",Pe,$(e(g)),1)),r(S,{disabled:e(o),onClick:s[1]||(s[1]=m=>d.value=!e(d))},{default:f(()=>[h($(e(d)?"Confirm":"Rename"),1)]),_:1},8,["disabled"]),r(S,{disabled:e(o),color:"danger",onClick:M},{default:f(()=>[h(" Delete ")]),_:1},8,["disabled"])]),u("div",{class:L({"itinerary-container":!0,"itinerary-list-visible":e(a),"itinerary-map-visible":!e(a)})},[u("section",be,[u("ol",null,[(y(!0),v(T,null,te(e(p).places,m=>(y(),v("li",{draggable:!0,onDragstart:x=>e(A).onStartDragging(m,x),onDragover:s[2]||(s[2]=x=>e(A).canDropOntoItem(x)),onDrop:x=>e(A).onDropEvent(m,x)},[r(G,{class:"itinerary-list-element"},{default:f(()=>[$e,u("p",null,$(m.name),1),r(S,{color:"danger",onClick:x=>b(m._id)},{default:f(()=>[Ce]),_:2},1032,["onClick"])]),_:2},1024)],40,Ae))),256))]),r(S,{"full-width":!0,disabled:e(o),color:"primary",onClick:s[3]||(s[3]=m=>t.value=!0)},{default:f(()=>[h(" + ")]),_:1},8,["disabled"])]),u("section",Ne,[r(H,{places:e(p).places,"focusable-places":!1,"show-places-names":!0,"connect-places":!0},null,8,["places"])]),r(S,{"full-width":!0,color:e(a)?"grey":"primary",radius:"0",class:"toggle-list-button",onClick:s[4]||(s[4]=m=>a.value=!e(a))},{default:f(()=>[u("span",{class:L({fa:!0,"fa-list":!e(a),"fa-map":e(a)})},null,2)]),_:1},8,["color"])],2),r(K,{open:e(t),onClosed:s[5]||(s[5]=m=>t.value=!1),onPlaceSelected:D},null,8,["open"]),r(Q,{disabled:e(o),color:"primary",class:"hidden-on-mobile",onClick:s[6]||(s[6]=m=>t.value=!0)},{default:f(()=>[h(" + ")]),_:1},8,["disabled"])],64)):(y(),v("p",xe,"Loading...")):(y(),v("p",we,[r(P,{to:"/login"},{default:f(()=>[h("Log in")]),_:1}),h(" or "),r(P,{to:"/register"},{default:f(()=>[h("Sign up")]),_:1}),h(" to create itineraries! ")]))])}}});const Ge=E(Te,[["__scopeId","data-v-59949cd7"]]);export{Ge as default};
